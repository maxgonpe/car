{% extends 'base.html' %}
{% block content %}

<div class="container py-3">
  <div class="d-flex justify-content-between align-items-left mb-3">
    <h4>ðŸ§© Componentes</h4>

    <a href="{% url 'componente_create' %}" class="btn btn-success btn-sm">+ Nuevo</a>
    <a href="{% url 'panel_principal' %}"             class="btn btn-warning btn-sm">Regresar</a>
  </div>

  <form class="mb-3">
    <div class="input-group">
      <input type="text" class="form-control" id="searchBox" placeholder="Buscar componente...">
    </div>
  </form>

  <div id="componentes-container">
    {% include 'car/componentes_tree.html' with componentes=componentes %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const searchBox = document.getElementById('searchBox');
  const container = document.getElementById('componentes-container');

  searchBox.addEventListener('keyup', function () {
    const query = this.value;
    fetch(`?q=${encodeURIComponent(query)}`, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.json())
    .then(data => {
      container.innerHTML = data.html;

      // Re-activar los colapsables de Bootstrap
      container.querySelectorAll('[data-bs-toggle="collapse"]').forEach(el => {
        new bootstrap.Collapse(el, { toggle: false });
      });
    });
  });
});
</script>


{% endblock %}
